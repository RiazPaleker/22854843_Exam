---
title: "Baby Names Analysis and Report"
documentclass: elsarticle
Thesis_FP: false
output:
  html_document:
    df_print: paged
  pdf_document:
    keep_tex: true
    template: Tex/TexDefault.txt
    fig_width: 3.5
    fig_height: 3.5
Author1: Jane Doe^
Ref1: Some Institution, Cape Town, South Africa
Email1: nfkatzke\@gmail.com
Author2: John Smith
Ref2: Some other Institution, Cape Town, South Africa
Email2: John\@gmail.com
CommonAffiliation_12: true
Author3: John Doe
Email3: Joe\@gmail.com
CorrespAuthor_1: true
keywords: Multivariate GARCH \sep Kalman Filter \sep Copula
JELCodes: L250 \sep L100
BottomRFooter: \footnotesize Page \thepage
addtoprule: true
addfootrule: true
margin: 2.3
bottom: 2
top: 2.5
HardSet_layout: true
linenumbers: false
bibliography: Tex/ref.bib
csl: "Tex/harvard-stellenbosch-university.csl"
RemovePreprintSubmittedTo: true
Journal: Journal of Finance
toc: false
numbersections: true
fontsize: 11pt
linestretch: 1.2
link-citations: true
AddTitle: true
abstract: |
  This report consists of a concise analysis and investigation to shed light on the factors affecting baby names. This is specficially done for a New York based kids' toy design agency.
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.width = 6, fig.height = 5, fig.pos="H", fig.pos = 'H')


# Lets load in example data, and see how this can be stored and later called from your 'data' folder.
if(!require("tidyverse")) install.packages("tidyverse")
library(tidyverse)

# Notice that as you are working in a .Rproj file (I am assuming you are) - the relative paths of your directories start at your specified root.
# This means that when working in a .Rproj file, you never need to use getwd() - it is assumed as your base root automatically.

```

```{r, include=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(stringdist)



Baby_Names <- readRDS("./data/US_Baby_names/Baby_Names_By_US_State.rds")
charts <- readRDS("./data/US_Baby_names/charts.rds")
HBO_Titles <- readRDS("./data/US_Baby_names/HBO_titles.rds")
HBO_Credits <- readRDS("./data/US_Baby_names/HBO_credits.rds")

```



```{r,include=FALSE}

top_25_names <- Baby_Names %>%
    group_by(Year, Gender) %>%
    top_n(25, Count) %>%
    ungroup()

# Function to calculate serial correlation
calculate_serial_correlation <- function(Baby_Names, start_year, gender, lag = 1:3) {
    correlation_results <- data.frame(Lag = integer(), Correlation = numeric())

    for (l in lag) {
        current_year_names <- Baby_Names %>%
            filter(Year == start_year, Gender == gender) %>%
            select(Name)

        next_year_names <- Baby_Names %>%
            filter(Year == (start_year + l), Gender == gender) %>%
            select(Name)

        common_names <- intersect(current_year_names$Name, next_year_names$Name)
        correlation <- length(common_names) / 25

        correlation_results <- rbind(correlation_results, data.frame(Lag = l, Correlation = correlation))
    }

    return(correlation_results)
}

# Apply the function to all years and genders
all_years <- unique(top_25_names$Year)
all_genders <- unique(top_25_names$Gender)
results <- data.frame(Year = integer(), Gender = character(), Lag = integer(), Correlation = numeric())

for (year in all_years) {
    for (gender in all_genders) {
        correlation_results <- calculate_serial_correlation(top_25_names, year, gender)
        correlation_results$Year <- year
        correlation_results$Gender <- gender
        results <- rbind(results, correlation_results)
    }
}

# Function to calculate average correlation by decade
average_correlation_by_decade <- function(results) {
    results %>%
        mutate(Decade = floor(Year / 10) * 10) %>%
        group_by(Decade, Gender, Lag) %>%
        summarise(Average_Correlation = mean(Correlation)) %>%
        ungroup()
}

# Calculate the average correlation by decade
decade_correlation <- average_correlation_by_decade(results)
```

# 1. Question One 

## 1.1 Pesristence in Popular Names

* The figure below shows the persistence of the top 25 popular names and that of the next 3 years
* F is female, while M is Male
* There is a significant peak during the late 1990s/2000s
* indication a strong persistence of popular names through this period for both males and females 
* There is a sharp decline after the peak in 2000, 
* suggesting a return to more frequent changes in name popularity. 
* Since the 2000's there is  a significant decrease in persistent name popularity for both males and females. 
* The recent data shows name popularity does not persist as it once did.

```{r, echo=FALSE}

# Plot the results to visualize the trends

corr_plot = decade_correlation %>% ggplot() +
    geom_line(aes(x = Decade, y = Average_Correlation, color = as.factor(Lag)))+
    facet_wrap(~ Gender) + labs(title = "Average Correlation of Popular Names by Decade",
                                              x = "Decade",
                                              y = "Average Correlation",
                                              color = "Subsequent Year")


corr_plot

```

# 1.2 Similarities between Names and Billboard Hot 100 for New York from 2010 to 2014

* The figure below shows the matching of the popularity of names (New York.) and artists who peaked number one on the Billboard Hot 100.
* I.E: represents the most popular names that are also names of artists that were number one at one point in a given year (from 2010 to 2014)
* New York is used specifically as this is where the agency is based
* The x-axis represents the most popular baby names that matched artist names from 2010 to 2014.
* Aiden, David, Liam and Lucas were popular in some years but not at all in other years. This can be a result of a popular song
* Names such as Emma, Ethan, Jacob, Michael and Sophia were constantly popular over these years.


```{r, include=FALSE}

subset_baby_names <- function(Baby_Names) {
    # Filter the data for the year 2014 and state New York
    filter_names <- Baby_Names %>%
        filter(Year>=2010 & Year<=2014, State == "NY", Count>=1000 )%>%
        arrange(desc(Count))

    return(filter_names[,-c(1,4,5)])
}

new_names =subset_baby_names(Baby_Names)

subset_charts  <- function(charts){

    filter_charts = charts %>%
        filter(date>="2010-01-01" & date<="2014-12-31", charts$`peak-rank`==1) %>%
        mutate(year = year(date)) %>%
        select(-date) %>%
        rename(date = year)


    return(filter_charts[,-c(1,2,4,5,6)])


}
charts_new=subset_charts(charts)
colnames(charts_new) =c("Name", "Year")


# Finding matches between names
matching_names <- stringdist::amatch(new_names$Name, charts_new$Name, maxDist = 5)

# Filter new_names that matches the artist names
names_to_plot <- new_names$Name[!is.na(matching_names)]

#  Aggregate counts across years for names that we need to plot
agg_data <- new_names %>%
    filter(Name %in% names_to_plot) %>%
    group_by(Name, Year) %>%
    summarise(TotalCount = sum(Count))

```

```{r, echo=FALSE}

# using ggplot
charts_names_plot = agg_data %>% ggplot() +
    geom_point(aes(x = Name, y = Year, size = TotalCount), shape = 21, fill="blue", alpha = 0.6, ) +
    guides(size = F)+ theme(axis.text.x = element_text(angle = 45, hjust = 1))+
    labs(title = "Popularity of Baby Names and Artists in Hot 100 Charts",
         x = "Names",
         y = "Year")

charts_names_plot

```

